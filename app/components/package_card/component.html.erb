<article
  class="w-full h-full border-solid border bg-white flex flex-col"
  itemscope
  itemtype="http://schema.org/Article"
  itemprop="itemListElement"
>
  <div class="p-2">
    <meta itemprop="position" content="<%= @position %>">
    <h2 class="py-1">
      <% (@package.authors || []).each do |author| %>
        <span class="pr-2">
          <%= render AuthorLinkComponent.new(author: author) %>
        </span>
      <% end %>
      <%= time_tag @package.published_at.to_date, class: 'inline-block', itemprop: 'datePublished' %>
    </h2>

    <%= link_to @package, itemprop: "url" do %>
      <h1 class="text-xl font-bold" itemprop="name headline">
        <%= @package.name %>
      </h1>
      <span class="text-l font-mono font-semibold">
        <span itemprop="alternateName">
          <%= @package.filename %>
        </span>
        <% if @package.file_size %>
          (<span itemprop="contentSize"><%= helpers.number_to_human_size(@package.file_size) %></span>)
        <% end %>
      </span>
    <% end %>

    <% if @package.too_big_for_online? %>
      <div class="pt-2">
        <span
          class="inline-block border-2 border-red-200 hover:border-red-400 bg-red-50 text-red-800 px-1 font-bold"
          title="<%= t('package.too_big_for_online.description', max: helpers.number_to_human_size(Package::ONLINE_LIMIT)) %>"
        >
          <%= t('package.too_big_for_online.short') %>
        </span>
      </div>
    <% end %>

    <div class="pt-2">
      <%= render KeywordLinksComponent.new(tags: @package.tags || [], categories: @package.categories || {}) %>
    </div>

    <%= simple_format \
      @package.post_text.present? \
        ? @package.post_text.truncate(150, separator: /\s/) \
        : helpers.package_description(@package, true),
      itemprop: 'description',
      class: 'pt-4'
    %>

    <% if @package.question_distribution.present? %>
      <p class="pt-4 text-gray-700">
        <%= t('total_questions') %>: <%= @package.question_distribution[:total] %>
      </p>
      <% @package.question_distribution[:types].each do |type, count| %>
        <span class="mr-4 inline-block text-gray-700">
          <div class="<%= ApplicationHelper::TYPE_COLORS[type] %> w-4 h-4 inline-block bottom-0"></div>
          <%= t type %>
          <%= number_to_percentage \
            count.to_f / @package.question_distribution[:total] * 100,
            precision: 0
          %>
        </span>
      <% end %>
    <% end %>
  </div>
  <div class="border-t divide-x flex">
    <% if @package.vk_download_url %>
      <%= link_to package_direct_download_path(@package),
       target: '_blank',
       class: "flex w-fit font-bold px-4 py-4 hover:bg-gray-100 items-center" \
       do
      %>
        <%= heroicon "document-download", options: { class: "h-6 mr-2 inline" } %>
        <span id="<%= dom_id(@package, :download_count) %>">
          <%= @package.download_count %>
        </span>
      <% end %>
    <% end %>
    <%= link_to t('source'), @package.source_link, target: '_blank',
     class: "flex font-bold px-4 py-4 hover:bg-gray-100 items-center" %>
  </div>
</article>
