<% content_for :title do %>
<%= t(
  'title_package',
  name: @package.name,
  authors: @package.authors.present? ? " (#{@package.authors.join(', ')})" : ''
) %>
<% end %>
<% content_for :description do %><%= package_description(@package) %><% end %>

<h1 class="text-2xl font-bold text-center">
  <%= @package.name %>
</h1>
<h2 class="text-xl font-bold text-center pb-4">
  <% if @package.authors.present? %>
    <p>
      <%= @package.authors.join(', ') %>
    </p>
  <% end %>
  <% if @package.tags.present? %>
    <p>
      <%= @package.tags.join(', ') %>
    </p>
  <% end %>
</h2>

<p>
  <%= t('sigame_package',
        link: link_to('SIGame', 'https://vladimirkhil.com/si/game', class: 'font-bold')).html_safe
  %>
  <%= t('sigame_author',
        link: link_to(t('khil'), 'https://vladimirkhil.com/', class: 'font-bold')).html_safe
  %>
</p>

<div class="mb-8">
  <% if @package.post_text.present? %>
    <h3 class="text-xl mb-2 text-center">
      <%= t('original_message') %>
    </h3>
    <%= simple_format(@package.post_text) %>
  <% end %>

  <% if @package.question_distribution.present? %>
    <h3 class="text-xl mb-2 mt-4 text-center">
      <%= t :questions %> <br>
    </h3>

    <p class="mb-2">
      <%= t :total_questions %>: <%= @package.question_distribution[:total] %>
    </p>
    <div class="w-full h-8 mb-2">
      <%= distribution(@package.question_distribution) %>
    </div>
    <% @package.question_distribution[:types].each do |type, count| %>
    <span class="mr-4 inline-block">
      <div class="<%= ApplicationHelper::TYPE_COLORS[type] %> w-4 h-4 inline-block bottom-0"></div>
      <span class="font-bold">
        <%= t type %>
      </span>
      <span class="text-gray-700">
        <%=
          number_to_percentage(
            count.to_f / @package.question_distribution[:total] * 100,
            precision: 0
          )
        %>
      </span>
    </span>
    <% end %>
  <% end %>

  <% if @package.structure.present? %>
    <h3 class="text-xl mb-4 text-center">
      <%= t('rounds') %>
    </h1>

    <ul
      class="mb-2 grid justify-items-center auto-rows-max gap-10"
      style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));"
    >
      <% @package.structure.each do |round| %>
      <li class="border-4 border-indigo-400 min-h-full min-w-full" style="max-width: 240px">
        <h4 class="text-center block font-bold">
          <%= round[:name] %>
        </h4>
        <ul class="m-4">
          <% round['themes'].each do |theme| %>
          <li class="mb-2">
            <%= theme['name'] %>
          </li>
          <% end %>
        </ul>
      </li>
      <% end %>
    </ul>
  <% end %>
</div>



<%= t('published_at') %>: <%= l @package.published_at.to_date %> <br>

<%= t('added_to_sibrowser') %>: <%= l @package.created_at.to_date %> <br>

<% if @package.created_at.to_date != @package.updated_at.to_date %>
  <%= t('updated_in_sibrowser') %>: <%= l @package.updated_at.to_date %> <br>
<% end %>

<% if @package.filename != @package.name + '.siq' %>
  <%= t('filename') %>: <%= @package.filename %> <br>
<% end %>


<div class="flex justify-center mt-8 mb-4">
  <a
    class="<%= button_class %>"
    href="<%= @package.source_link %>"
  >
    <%= t('download_from_source') %>
  </a>
</div>
